<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Audio network - physical layer example</title>
        <link rel="stylesheet" type="text/css" href="physical-layer.css">
        <meta name="viewport" content="width=device-width,initial-scale=1">
    </head>
    <body onLoad="onLoad()">

        <div class="container">

            <h1>Audio network - physical layer example</h1>
            <div>
                <div class="row">
                    <div class="col col-sx-12">
                        <p>
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor
                            incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud
                            exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute
                            irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla
                            pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia
                            deserunt mollit anim id est laborum.
                        </p>
                        <p>
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor
                            incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud
                            exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute
                            irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla
                            pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia
                            deserunt mollit anim id est laborum.
                        </p>
                    </div>
                </div>
            </div>

            <h2>Initialize</h2>
            <div>

                <div class="row margin-bottom">
                    <div class="col col-md-3 col-sm-5 col-xs-6">
                        <b>
                            DFT time span [sec]
                        </b>
                    </div>
                    <div class="col col-md-6 col-sm-7 col-xs-6">
                        <input
                            type="text"
                            id="rx-dft-time-span"
                            value="0.250"
                            />
                    </div>
                </div>

                <div class="row margin-bottom">
                    <div class="col col-md-3 col-sm-5 col-xs-6">
                        <b>
                            Rx notifications per second
                        </b>
                    </div>
                    <div class="col col-md-6 col-sm-7 col-xs-6">
                        <input
                            type="text"
                            id="rx-notification-per-second"
                            value="25"
                            />
                    </div>
                </div>

                <div class="row margin-bottom">
                    <div class="col col-md-3 col-sm-5 col-xs-6">
                        <b>
                            Rx spectrum
                        </b>
                    </div>
                    <div class="col col-md-6 col-sm-7 col-xs-6">
                        <input
                            type="checkbox"
                            checked="checked"
                            id="rx-spectrum-visible"
                            value="1"
                            />
                    </div>
                </div>

                <div class="row margin-bottom">
                    <div class="col col-md-3 col-sm-5 col-xs-6">
                        <b>
                            Constellation diagram
                        </b>
                    </div>
                    <div class="col col-md-6 col-sm-7 col-xs-6">
                        <input
                            type="checkbox"
                            checked="checked"
                            id="rx-constellation-diagram-visible"
                            value="1"
                            />
                    </div>
                </div>

                <div class="row margin-bottom">
                    <div class="col col-md-3 col-sm-5 col-xs-6">
                        <b>
                            RX channel config
                        </b>
                    </div>
                    <div class="col col-md-6 col-sm-7 col-xs-6">
                        <input
                            type="text"
                            id="rx-channel"
                            value="1070-1-16"
                            />
                    </div>
                </div>

                <div class="row margin-bottom">
                    <div class="col col-md-3 col-sm-5 col-xs-6">
                        <b>
                            TX channel config
                        </b>
                    </div>
                    <div class="col col-md-6 col-sm-7 col-xs-6">
                        <input
                            type="text"
                            id="tx-channel"
                            value="1070-1-16"
                            />
                    </div>
                </div>

                <div class="row margin-bottom">
                    <div class="col col-md-3 col-sm-5 col-xs-6">
                    </div>
                    <div class="col col-md-6 col-sm-7 col-xs-6">
                        <button class="btn btn-default" onClick="reinitialize()">Reinitialize</button>
                        <button class="btn btn-default" onClick="destroy()">Destroy</button>
                    </div>
                </div>

            </div>

            <h2>General info/settings</h2>
            <div>

                <div class="row margin-bottom">
                    <div class="col col-md-3 col-sm-5 col-xs-6">
                        <b>Sample rate [Hz]</b>
                    </div>
                    <div class="col col-md-6 col-sm-7 col-xs-6">
                        <span id="sample-rate"></span>
                    </div>
                </div>

                <div class="row margin-bottom">
                    <div class="col col-md-3 col-sm-5 col-xs-6">
                        <label for="symbol-duration">
                            Symbol duration [ms]
                        </label>
                    </div>
                    <div class="col col-md-6 col-sm-7 col-xs-6">
                        <input type="text" id="symbol-duration" value="250" />
                    </div>
                </div>

                <div class="row margin-bottom">
                    <div class="col col-md-3 col-sm-5 col-xs-6">
                        <label for="guard-interval">
                            Guard interval [ms]
                        </label>
                    </div>
                    <div class="col col-md-6 col-sm-7 col-xs-6">
                        <input type="text" id="guard-interval" value="250" />
                    </div>
                </div>

            </div>

            <h2>Receive</h2>
            <div>

                <div class="row margin-bottom">
                    <div class="col col-md-3 col-sm-5 col-xs-6">
                        <b>Rx buffer size</b>
                    </div>
                    <div class="col col-md-6 col-sm-7 col-xs-6">
                        <span id="rx-buffer-size"></span>
                    </div>
                </div>

                <div class="row margin-bottom">
                    <div class="col col-md-3 col-sm-5 col-xs-6">
                        <b>Source</b>
                    </div>
                    <div class="col col-md-6 col-sm-7 col-xs-6">
                        <button class="btn btn-default" onClick="rxInput('mic')">Microphone</button>
                        <button class="btn btn-default" onClick="rxInput('rxLoop')">RxLoopback</button>
                        <button class="btn btn-default" onClick="rxInput('rec')">Recorded audio</button>
                    </div>
                </div>

                <div class="row margin-bottom">
                    <div class="col col-xs-12">
                        <div id="rx-spectrum"></div>
                    </div>
                </div>

                <div class="row margin-bottom" id="rx-channel-container">
                </div>

            </div>

            <h2>Transmit</h2>
            <div>

                <div class="row margin-bottom">
                    <div class="col col-md-3 col-sm-5 col-xs-6">
                        <b>Tx buffer size</b>
                    </div>
                    <div class="col col-md-6 col-sm-7 col-xs-6">
                        <span id="tx-buffer-size"></span>
                    </div>
                </div>

                <div class="row margin-bottom">
                    <div class="col col-md-3 col-sm-5 col-xs-6">
                        <b>Recorded audio url</b>
                    </div>
                    <div class="col col-md-6 col-sm-7 col-xs-6">
                        <input type="text" id="recorded-audio-url" value="http://localhost:63342/ucEmu/an.wav" />
                        <button class="btn btn-default" onClick="loadRecordedAudio()">Load</button>
                    </div>
                </div>

                <div class="row margin-bottom">
                    <div class="col col-md-3 col-sm-5 col-xs-6">
                        <b>Output [tx]</b>
                    </div>
                    <div class="col col-md-6 col-sm-7 col-xs-6">
                        <button 
                            id="tx-output-tx-enable"
                            class="btn btn-default" 
                            onClick="output('tx', true)"
                            >
                            Enable
                        </button>
                        <button 
                            id="tx-output-tx-disable"
                            class="btn btn-default" 
                            onClick="output('tx', false)"
                            >
                            Disable
                        </button>
                    </div>
                </div>
                <div class="row margin-bottom">
                    <div class="col col-md-3 col-sm-5 col-xs-6">
                        <b>Output [microphone]</b>
                    </div>
                    <div class="col col-md-6 col-sm-7 col-xs-6">
                        <button 
                            id="tx-output-mic-enable"
                            class="btn btn-default" 
                            onClick="output('mic', true)"
                            >
                            Enable
                        </button>
                        <button 
                            id="tx-output-mic-disable"
                            class="btn btn-default" 
                            onClick="output('mic', false)"
                            >
                            Disable
                        </button>
                    </div>
                </div>
                <div class="row margin-bottom">
                    <div class="col col-md-3 col-sm-5 col-xs-6">
                        <b>Output [recorded audio]</b>
                    </div>
                    <div class="col col-md-6 col-sm-7 col-xs-6">
                        <button 
                            id="tx-output-rec-enable"   
                            class="btn btn-default" 
                            onClick="output('rec', true)"
                            >
                            Enable
                        </button>
                        <button 
                            id="tx-output-rec-disable"  
                            class="btn btn-default" 
                            onClick="output('rec', false)"
                            >
                            Disable
                        </button>
                    </div>
                </div>

                <div class="row margin-bottom" id="tx-channel-container">
                </div>

            </div>

        </div>

        <footer>
            <div class="row">
                <div class="col col-xs-12">
                    <div class="copyright">Robert Rypula 2016</div>
                </div>
            </div>
        </footer>

        <!-- audio network BEGIN -->
        <script src="../../src/common/math-util/math-util.service.js"></script>
        <script src="../../src/common/audio-util/audio-util.service.js"></script>
        <script src="../../src/common/queue/queue.factory.js"></script>
        <script src="../../src/common/queue/queue-builder.service.js"></script>
        <script src="../../src/physial-layer/analyser-chart/analyser-chart.factory.js"></script>
        <script src="../../src/physial-layer/audio/audio.service.js"></script>
        <script src="../../src/physial-layer/constellation-diagram/constellation-diagram.factory.js"></script>
        <script src="../../src/physial-layer/carrier-generate/carrier-generate.factory.js"></script>
        <script src="../../src/physial-layer/channel-receive/channel-receive.factory.js"></script>
        <script src="../../src/physial-layer/carrier-recovery/carrier-recovery.factory.js"></script>
        <script src="../../src/physial-layer/channel-transmit/channel-transmit.factory.js"></script>
        <script src="../../src/physial-layer/channel-transmit-manager/channel-transmit-manager.factory.js"></script>
        <script src="../../src/physial-layer/channel-receive-manager/channel-receive-manager.factory.js"></script>
        <script src="../../src/physial-layer/constellation-diagram/constellation-diagram-builder.service.js"></script>
        <script src="../../src/physial-layer/channel-transmit-manager/channel-transmit-manager-builder.service.js"></script>
        <script src="../../src/physial-layer/channel-receive-manager/channel-receive-manager-builder.service.js"></script>
        <script src="../../src/physial-layer/carrier-recovery/carrier-recovery-builder.service.js"></script>
        <script src="../../src/physial-layer/channel-transmit/channel-transmit-builder.service.js"></script>
        <script src="../../src/physial-layer/channel-receive/channel-receive-builder.service.js"></script>
        <script src="../../src/physial-layer/carrier-generate/carrier-generate-builder.service.js"></script>
        <script src="../../src/physial-layer/analyser-chart/analyser-chart-builder.service.js"></script>
        <script src="../../src/physial-layer/rx-handler/rx-handler.factory.js"></script>
        <script src="../../src/physial-layer/rx-handler/rx-handler-builder.service.js"></script>
        <script src="../../src/physial-layer/audio-network-physical-layer.factory.js"></script>
        <script src="../../src/physial-layer/audio-network-physical-layer-configuration.service.js"></script>
        <!-- audio network END -->

        <script id="template-tx-channel" type="text/html">
            <!-- channel begin -->
            <div class="col col-xs-12 tx-channel">
                <div class="row margin-bottom">
                    <div class="col col-xs-12">
                        <h3>TX Channel #[[ channelIndex ]]</h3>
                    </div>
                </div>
                
                <div class="row margin-bottom">
                    <div class="col col-md-3 col-sm-5 col-xs-6">
                        <b>PSK symbol size:</b>
                    </div>
                    <div class="col col-md-6 col-sm-7 col-xs-6">
                        <input
                            type="number"
                            id="tx-psk-size-[[ channelIndex ]]"
                            value="4"
                            onChange="uiRefreshOnPskSizeChange('tx', [[ channelIndex ]])"
                            />
                    </div>
                </div>

                <div class="row margin-bottom">
                    <div class="col col-md-3 col-sm-5 col-xs-6">
                        <b>Send frame</b>
                    </div>
                    <div class="col col-md-6 col-sm-7 col-xs-6">
                        <textarea
                            class="data-frame-textarea"
                            id="tx-data-frame-[[ channelIndex ]]"
                            ></textarea>
                        <button class="btn btn-default" onClick="transmit([[ channelIndex ]])">Send frame</button>
                    </div>
                </div>

                <div class="row margin-bottom" id="tx-channel-[[ channelIndex ]]-ofdm-container">
                </div>
            </div>
            <!-- channel end -->
        </script>

        <script id="template-tx-channel-ofdm" type="text/html">
            <!-- ofdm begin -->
            <div class="col col-xs-12 col-md-6 col-lg-4">
                <div class="tx-channel-ofdm">
                    <div class="row margin-bottom">
                        <div class="col col-xs-12">
                            <h4>TX Channel #[[ channelIndex ]] - subcarrier #[[ ofdmIndex ]]</h4>
                        </div>
                    </div>

                    <div class="row margin-bottom">
                        <div class="col col-xs-6">
                            <label for="tx-frequency-input-[[ channelIndex ]]-[[ ofdmIndex ]]">Frequency [Hz]</label>
                        </div>
                        <div class="col col-xs-6">
                            <span id="tx-frequency-label-[[ channelIndex ]]-[[ ofdmIndex ]]"></span>
                            <input type="number" id="tx-frequency-input-[[ channelIndex ]]-[[ ofdmIndex ]]" />
                            <button 
                                class="btn btn-default"
                                onClick="frequencyUpdate('tx', [[ channelIndex ]], [[ ofdmIndex ]])"
                                >
                                Update
                            </button>
                        </div>
                    </div>
                    <div class="row margin-bottom">
                        <div class="col col-xs-6">
                            <label for="tx-phase-correction-input-[[ channelIndex ]]-[[ ofdmIndex ]]">
                                Phase correction
                            </label>
                        </div>
                        <div class="col col-xs-6">
                            <span id="tx-phase-correction-label-[[ channelIndex ]]-[[ ofdmIndex ]]"></span>
                            <input type="number" id="tx-phase-correction-input-[[ channelIndex ]]-[[ ofdmIndex ]]" />
                            <button 
                                class="btn btn-default"
                                onClick="phaseCorrectionUpdate('tx', [[ channelIndex ]], [[ ofdmIndex ]])"
                                >
                                Update
                            </button>
                        </div>
                    </div>

                    <div class="row margin-bottom">
                        <div class="col col-xs-6">
                            <b>Amplitude</b>
                        </div>
                        <div class="col col-xs-6">
                            <input 
                                type="number" 
                                id="tx-amplitude-input-[[ channelIndex ]]-[[ ofdmIndex ]]" 
                                value="1" 
                                />
                        </div>
                    </div>

                    <div class="row margin-bottom">
                        <div class="col col-xs-6">
                            <b>Symbol send</b>
                        </div>
                        <div class="col col-xs-6">
                            <div class="tx-symbol" id="tx-symbol-[[ channelIndex ]]-[[ ofdmIndex ]]"></div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- ofdm end -->
        </script>

        <script id="template-rx-channel" type="text/html">
            <!-- channel begin -->
            <div class="col col-xs-12 rx-channel">
                <div class="row margin-bottom">
                    <div class="col  col-xs-12">
                        <h3>RX Channel #[[ channelIndex ]]</h3>
                    </div>
                </div>

                <div class="row margin-bottom">
                    <div class="col col-md-3 col-sm-5 col-xs-6">
                        <b>RX sampling - STATE</b>
                    </div>
                    <div class="col col-md-6 col-sm-7 col-xs-6">
                        <span id="rx-sampling-state-[[ channelIndex ]]"></span>
                    </div>
                </div>

                <div class="row margin-bottom">
                    <div class="col col-md-3 col-sm-5 col-xs-6">
                        <b>RX sampling - SYMBOL</b>
                    </div>
                    <div class="col col-md-6 col-sm-7 col-xs-6">
                        <span id="rx-sampling-symbol-[[ channelIndex ]]"></span>
                    </div>
                </div>

                <div class="row margin-bottom">
                    <div class="col col-md-3 col-sm-5 col-xs-6">
                        <b>RX sampling - PACKET</b>
                    </div>
                    <div class="col col-md-6 col-sm-7 col-xs-6">
                        <span id="rx-sampling-packet-[[ channelIndex ]]"></span>
                    </div>
                </div>

                <div class="row margin-bottom">
                    <div class="col col-md-3 col-sm-5 col-xs-6">
                        <b>RX sampling - PACKET HISTORY</b>
                    </div>
                    <div class="col col-md-6 col-sm-7 col-xs-6">
                        <span id="rx-sampling-packet-history-[[ channelIndex ]]"></span>
                    </div>
                </div>

                <div class="row margin-bottom">
                    <div class="col col-md-3 col-sm-5 col-xs-6">
                        <b>PSK symbol size</b>
                    </div>
                    <div class="col col-md-6 col-sm-7 col-xs-6">
                        <input
                            type="number"
                            id="rx-psk-size-[[ channelIndex ]]"
                            onChange="uiRefreshOnPskSizeChange('rx', [[ channelIndex ]])"
                            value="4"
                            />
                    </div>
                </div>

                <div class="row margin-bottom">
                    <div class="col col-md-3 col-sm-5 col-xs-6">
                        <b>Power threshold [dB]</b>
                    </div>
                    <div class="col col-md-6 col-sm-7 col-xs-6">
                        <input type="number" id="rx-power-threshold-[[ channelIndex ]]" value="-20" />
                    </div>
                </div>

                <div class="row margin-bottom" id="rx-channel-[[ channelIndex ]]-ofdm-container">
                </div>
            </div>
            <!-- channel end -->
        </script>

        <script id="template-rx-channel-ofdm" type="text/html">
            <!-- ofdm begin -->
            <div class="col col-xs-12 col-md-6 col-lg-4">
                <div class="rx-channel-ofdm">
                    <div class="row margin-bottom">
                        <div class="col col-xs-12">
                            <h4>RX Channel #[[ channelIndex ]] - subcarrier #[[ ofdmIndex ]]</h4>
                        </div>
                    </div>
                    <div class="row margin-bottom">
                        <div class="col col-xs-12">
                            <div
                                class="rx-constellation-diagram"
                                id="rx-constellation-diagram-[[ channelIndex ]]-[[ ofdmIndex ]]"
                            ></div>
                        </div>
                    </div>

                    <div class="row margin-bottom">
                        <div class="col col-xs-6">
                            <b>Symbol received</b>
                        </div>
                        <div class="col col-xs-6">
                            <div class="rx-symbol" id="rx-symbol-[[ channelIndex ]]-[[ ofdmIndex ]]"></div>
                        </div>
                    </div>

                    <div class="row margin-bottom">
                        <div class="col col-xs-6">
                            <b>Phase [deg, unit]</b>
                        </div>
                        <div class="col col-xs-6">
                            <span id="rx-phase-[[ channelIndex ]]-[[ ofdmIndex ]]"></span>
                        </div>
                    </div>
                    <div class="row margin-bottom">
                        <div class="col col-xs-6">
                            <b>Power [dB]</b>
                        </div>
                        <div class="col col-xs-6">
                            <span id="rx-power-[[ channelIndex ]]-[[ ofdmIndex ]]"></span>
                        </div>
                    </div>
                    <div class="row margin-bottom">
                        <div class="col col-xs-6">
                            <label for="rx-frequency-input-[[ channelIndex ]]-[[ ofdmIndex ]]">Frequency [Hz]</label>
                        </div>
                        <div class="col col-xs-6">
                            <span id="rx-frequency-label-[[ channelIndex ]]-[[ ofdmIndex ]]"></span>
                            <input type="number" id="rx-frequency-input-[[ channelIndex ]]-[[ ofdmIndex ]]" />
                            <button 
                                class="btn btn-default"
                                onClick="frequencyUpdate('rx', [[ channelIndex ]], [[ ofdmIndex ]])"
                                >
                                Update
                            </button>
                        </div>
                    </div>
                    <div class="row margin-bottom">
                        <div class="col col-xs-6">
                            <label for="rx-phase-correction-input-[[ channelIndex ]]-[[ ofdmIndex ]]">
                                Phase correction
                            </label>
                        </div>
                        <div class="col col-xs-6">
                            <span id="rx-phase-correction-label-[[ channelIndex ]]-[[ ofdmIndex ]]"></span>
                            <input type="number" id="rx-phase-correction-input-[[ channelIndex ]]-[[ ofdmIndex ]]" />
                            <button 
                                class="btn btn-default"
                                onClick="phaseCorrectionUpdate('rx', [[ channelIndex ]], [[ ofdmIndex ]])"
                                >
                                Update
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- ofdm end -->
        </script>

        <script src="physical-layer-template-util.js"></script>
        <script src="physical-layer-receive.js"></script>
        <script src="physical-layer-transmit.js"></script>
        <script src="physical-layer.js"></script>
    </body>
</html>