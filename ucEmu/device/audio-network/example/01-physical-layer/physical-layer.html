<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Audio network - physical layer example</title>
        <link rel="stylesheet" type="text/css" href="physical-layer.css">
    </head>
    <body onLoad="onLoad()">

        <div class="main-container">

            <h1>Audio network - physical layer example</h1>

            <h2>Settings/info</h2>
            <div class="container">

                <div class="row">
                    <div class="col-3">
                        <b>Sample rate [Hz]</b>
                    </div>
                    <div class="col-6">
                        <span id="sample-rate"></span>
                    </div>
                </div>

                <div class="row">
                    <div class="col-3">
                        <b>
                            DFT time span [sec]
                        </b>
                    </div>
                    <div class="col-6">
                        <input
                            type="text"
                            id="rx-dft-time-span"
                            value="0.250"
                            />
                    </div>
                </div>
                <div class="row">
                    <div class="col-3">
                        <b>
                            Rx spectrum
                        </b>
                    </div>
                    <div class="col-6">
                        <input
                            type="checkbox"
                            checked="checked"
                            id="rx-spectrum-visible"
                            value="1"
                            />
                    </div>
                </div>
                <div class="row">
                    <div class="col-3">
                        <b>
                            Constellation diagram
                        </b>
                    </div>
                    <div class="col-6">
                        <input
                            type="checkbox"
                            checked="checked"
                            id="rx-constellation-diagram-visible"
                            value="1"
                            />
                    </div>
                </div>
                <div class="row">
                    <div class="col-3">
                        <b>
                            Channel config [rx/tx]
                        </b>
                    </div>
                    <div class="col-6">
                        <input
                            type="text"
                            id="rx-channel"
                            value="1070-1-16"
                            />
                        <input
                            type="text"
                            id="tx-channel"
                            value="1070-1-16"
                            />
                        <a href="javascript:void(0)" onClick="reinitialize()">Reinitialize</a>
                        <a href="javascript:void(0)" onClick="destroy()">Destroy</a>
                    </div>
                </div>

                <div class="row">
                    <div class="col-3">
                        <label for="symbol-duration">
                            Symbol duration [ms]
                        </label>
                    </div>
                    <div class="col-6">
                        <input type="text" id="symbol-duration" value="250" />
                    </div>
                </div>

                <div class="row">
                    <div class="col-3">
                        <label for="guard-interval">
                            Guard interval [ms]
                        </label>
                    </div>
                    <div class="col-6">
                        <input type="text" id="guard-interval" value="250" />
                    </div>
                </div>

            </div>

            <h2>Receive</h2>
            <div class="container">

                <div class="row">
                    <div class="col-3">
                        <b>Rx buffer size</b>
                    </div>
                    <div class="col-6">
                        <span id="rx-buffer-size"></span>
                    </div>
                </div>

                <div class="row">
                    <div class="col-3">
                        <b>Source</b>
                    </div>
                    <div class="col-6">
                        <a href="javascript:void(0)" onClick="rxInput('mic')">Microphone</a>
                        <a href="javascript:void(0)" onClick="rxInput('rxLoop')">RxLoopback</a>
                        <a href="javascript:void(0)" onClick="rxInput('rec')">Recorded audio</a>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <h3>Source spectrum</h3>
                    </div>                    
                </div>
                <div class="row">
                    <div class="col-12">
                        <div id="rx-spectrum"></div>
                    </div>
                </div>

                <div class="row" id="rx-channel-container">
                </div>

            </div>

            <h2>Transmit</h2>
            <div class="container">

                <div class="row">
                    <div class="col-3">
                        <b>Tx buffer size</b>
                    </div>
                    <div class="col-6">
                        <span id="tx-buffer-size"></span>
                    </div>
                </div>

                <div class="row">
                    <div class="col-3">
                        <b>Recorded audio url</b>
                    </div>
                    <div class="col-6">
                        <input type="text" id="recorded-audio-url" value="http://localhost:63342/ucEmu/an.wav" />
                        <a href="javascript:void(0)" onClick="loadRecordedAudio()">Load</a>
                    </div>
                </div>

                <div class="row">
                    <div class="col-3">
                        <b>Output [tx]</b>
                    </div>
                    <div class="col-6">
                        <a href="javascript:void(0)" onClick="output('tx', true)">Enable</a>
                        <a href="javascript:void(0)" onClick="output('tx', false)">Disable</a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-3">
                        <b>Output [microphone]</b>
                    </div>
                    <div class="col-6">
                        <a href="javascript:void(0)" onClick="output('mic', true)">Enable</a>
                        <a href="javascript:void(0)" onClick="output('mic', false)">Disable</a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-3">
                        <b>Output [recorded audio]</b>
                    </div>
                    <div class="col-6">
                        <a href="javascript:void(0)" onClick="output('rec', true)">Enable</a>
                        <a href="javascript:void(0)" onClick="output('rec', false)">Disable</a>
                    </div>
                </div>

                <div class="row" id="tx-channel-container">
                </div>

            </div>

        </div>

        <!-- audio network BEGIN -->
        <script src="../../src/common/math-util/math-util.service.js"></script>
        <script src="../../src/common/audio-util/audio-util.service.js"></script>
        <script src="../../src/common/queue/queue.factory.js"></script>
        <script src="../../src/common/queue/queue-builder.service.js"></script>
        <script src="../../src/physial-layer/analyser-chart/analyser-chart.factory.js"></script>
        <script src="../../src/physial-layer/audio/audio.service.js"></script>
        <script src="../../src/physial-layer/constellation-diagram/constellation-diagram.factory.js"></script>
        <script src="../../src/physial-layer/carrier-generate/carrier-generate.factory.js"></script>
        <script src="../../src/physial-layer/channel-receive/channel-receive.factory.js"></script>
        <script src="../../src/physial-layer/carrier-recovery/carrier-recovery.factory.js"></script>
        <script src="../../src/physial-layer/channel-transmit/channel-transmit.factory.js"></script>
        <script src="../../src/physial-layer/channel-transmit-manager/channel-transmit-manager.factory.js"></script>
        <script src="../../src/physial-layer/channel-receive-manager/channel-receive-manager.factory.js"></script>
        <script src="../../src/physial-layer/constellation-diagram/constellation-diagram-builder.service.js"></script>
        <script src="../../src/physial-layer/channel-transmit-manager/channel-transmit-manager-builder.service.js"></script>
        <script src="../../src/physial-layer/channel-receive-manager/channel-receive-manager-builder.service.js"></script>
        <script src="../../src/physial-layer/carrier-recovery/carrier-recovery-builder.service.js"></script>
        <script src="../../src/physial-layer/channel-transmit/channel-transmit-builder.service.js"></script>
        <script src="../../src/physial-layer/channel-receive/channel-receive-builder.service.js"></script>
        <script src="../../src/physial-layer/carrier-generate/carrier-generate-builder.service.js"></script>
        <script src="../../src/physial-layer/analyser-chart/analyser-chart-builder.service.js"></script>
        <script src="../../src/physial-layer/rx-handler/rx-handler.factory.js"></script>
        <script src="../../src/physial-layer/rx-handler/rx-handler-builder.service.js"></script>
        <script src="../../src/physial-layer/audio-network-physical-layer.factory.js"></script>
        <script src="../../src/physial-layer/audio-network-physical-layer-configuration.service.js"></script>
        <!-- audio network END -->

        <script id="template-tx-channel" type="text/html">
            <!-- channel begin -->
            <div class="col tx-channel">
                <div class="row">
                    <div class="col-12">
                        <h3>Channel #[[ channelIndex ]]</h3>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-3">
                        <b>PSK symbol size:</b>
                    </div>
                    <div class="col-6">
                        <input
                            type="number"
                            id="tx-psk-size-[[ channelIndex ]]"
                            value="4"
                            onChange="uiRefreshOnPskSizeChange('tx', [[ channelIndex ]])"
                            />
                    </div>
                </div>

                <div class="row">
                    <div class="col-3">
                        <b>Send frame</b>
                    </div>
                    <div class="col-6">
                        <textarea
                            class="data-frame-textarea"
                            id="tx-data-frame-[[ channelIndex ]]"
                            ></textarea>
                        <a href="javascript:void(0)" onClick="transmit([[ channelIndex ]])">Send frame</a>
                    </div>
                </div>

                <div class="row" id="tx-channel-[[ channelIndex ]]-ofdm-container">
                </div>
            </div>
            <!-- channel end -->
        </script>

        <script id="template-tx-channel-ofdm" type="text/html">
            <!-- ofdm begin -->
            <div class="col tx-channel-ofdm">
                <div class="row">
                    <div class="col-12">
                        <h4>Channel #[[ channelIndex ]], OFDM #[[ ofdmIndex ]]</h4>
                    </div>
                </div>

                <div class="row">
                    <div class="col-3">
                        <label for="tx-frequency-input-[[ channelIndex ]]-[[ ofdmIndex ]]">Frequency [Hz]</label>
                    </div>
                    <div class="col-6">
                        <span id="tx-frequency-label-[[ channelIndex ]]-[[ ofdmIndex ]]"></span>
                        <input type="number" id="tx-frequency-input-[[ channelIndex ]]-[[ ofdmIndex ]]" />
                        <a
                            href="javascript:void(0)"
                            onClick="frequencyUpdate('tx', [[ channelIndex ]], [[ ofdmIndex ]])"
                            >
                            Update
                        </a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-3">
                        <label for="tx-phase-correction-input-[[ channelIndex ]]-[[ ofdmIndex ]]">
                            Phase correction
                        </label>
                    </div>
                    <div class="col-6">
                        <span id="tx-phase-correction-label-[[ channelIndex ]]-[[ ofdmIndex ]]"></span>
                        <input type="number" id="tx-phase-correction-input-[[ channelIndex ]]-[[ ofdmIndex ]]" />
                        <a
                            href="javascript:void(0)"
                            onClick="phaseCorrectionUpdate('tx', [[ channelIndex ]], [[ ofdmIndex ]])"
                            >
                            Update
                        </a>
                    </div>
                </div>

                <div class="row">
                    <div class="col-3">
                        <b>Amplitude</b>
                    </div>
                    <div class="col-6">
                        <input 
                            type="number" 
                            id="tx-amplitude-input-[[ channelIndex ]]-[[ ofdmIndex ]]" 
                            value="1" 
                            />
                    </div>
                </div>

                <div class="row">
                    <div class="col-3">
                        <b>Symbol send</b>
                    </div>
                    <div class="col-6">
                        <div class="tx-symbol" id="tx-symbol-[[ channelIndex ]]-[[ ofdmIndex ]]"></div>
                    </div>
                </div>
            </div>
            <!-- ofdm end -->
        </script>

        <script id="template-rx-channel" type="text/html">
            <!-- channel begin -->
            <div class="col rx-channel">
                <div class="row">
                    <div class="col-12">
                        <h3>Channel #[[ channelIndex ]]</h3>
                    </div>
                </div>

                <div class="row">
                    <div class="col-3">
                        <b>RX sampling - STATE</b>
                    </div>
                    <div class="col-6">
                        <span id="rx-sampling-state-[[ channelIndex ]]"></span>
                    </div>
                </div>

                <div class="row">
                    <div class="col-3">
                        <b>RX sampling - SYMBOL</b>
                    </div>
                    <div class="col-6">
                        <span id="rx-sampling-symbol-[[ channelIndex ]]"></span>
                    </div>
                </div>

                <div class="row">
                    <div class="col-3">
                        <b>RX sampling - PACKET</b>
                    </div>
                    <div class="col-6">
                        <span id="rx-sampling-packet-[[ channelIndex ]]"></span>
                    </div>
                </div>

                <div class="row">
                    <div class="col-3">
                        <b>RX sampling - PACKET HISTORY</b>
                    </div>
                    <div class="col-6">
                        <span id="rx-sampling-packet-history-[[ channelIndex ]]"></span>
                    </div>
                </div>

                <div class="row">
                    <div class="col-3">
                        <b>PSK symbol size</b>
                    </div>
                    <div class="col-6">
                        <input
                            type="number"
                            id="rx-psk-size-[[ channelIndex ]]"
                            onChange="uiRefreshOnPskSizeChange('rx', [[ channelIndex ]])"
                            value="4"
                            />
                    </div>
                </div>

                <div class="row">
                    <div class="col-3">
                        <b>Power threshold [dB]</b>
                    </div>
                    <div class="col-6">
                        <input type="number" id="rx-power-threshold-[[ channelIndex ]]" value="-20" />
                    </div>
                </div>

                <div class="row" id="rx-channel-[[ channelIndex ]]-ofdm-container">
                </div>
            </div>
            <!-- channel end -->
        </script>

        <script id="template-rx-channel-ofdm" type="text/html">
            <!-- ofdm begin -->
            <div class="col rx-channel-ofdm">
                <div class="row">
                    <div class="col-12">
                        <h4>Channel #[[ channelIndex ]], OFDM #[[ ofdmIndex ]]</h4>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <div
                            class="rx-constellation-diagram"
                            id="rx-constellation-diagram-[[ channelIndex ]]-[[ ofdmIndex ]]"
                        ></div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-3">
                        <b>Symbol received</b>
                    </div>
                    <div class="col-6">
                        <div class="rx-symbol" id="rx-symbol-[[ channelIndex ]]-[[ ofdmIndex ]]"></div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-3">
                        <b>Phase [deg, unit]</b>
                    </div>
                    <div class="col-6">
                        <span id="rx-phase-[[ channelIndex ]]-[[ ofdmIndex ]]"></span>
                    </div>
                </div>
                <div class="row">
                    <div class="col-3">
                        <b>Power [dB]</b>
                    </div>
                    <div class="col-6">
                        <span id="rx-power-[[ channelIndex ]]-[[ ofdmIndex ]]"></span>
                    </div>
                </div>
                <div class="row">
                    <div class="col-3">
                        <label for="rx-frequency-input-[[ channelIndex ]]-[[ ofdmIndex ]]">Frequency [Hz]</label>
                    </div>
                    <div class="col-6">
                        <span id="rx-frequency-label-[[ channelIndex ]]-[[ ofdmIndex ]]"></span>
                        <input type="number" id="rx-frequency-input-[[ channelIndex ]]-[[ ofdmIndex ]]" />
                        <a
                            href="javascript:void(0)"
                            onClick="frequencyUpdate('rx', [[ channelIndex ]], [[ ofdmIndex ]])"
                            >
                            Update
                        </a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-3">
                        <label for="rx-phase-correction-input-[[ channelIndex ]]-[[ ofdmIndex ]]">
                            Phase correction
                        </label>
                    </div>
                    <div class="col-6">
                        <span id="rx-phase-correction-label-[[ channelIndex ]]-[[ ofdmIndex ]]"></span>
                        <input type="number" id="rx-phase-correction-input-[[ channelIndex ]]-[[ ofdmIndex ]]" />
                        <a
                            href="javascript:void(0)"
                            onClick="phaseCorrectionUpdate('rx', [[ channelIndex ]], [[ ofdmIndex ]])"
                            >
                            Update
                        </a>
                    </div>
                </div>
            </div>
            <!-- ofdm end -->
        </script>

        <script src="physical-layer-template-util.js"></script>
        <script src="physical-layer-receive.js"></script>
        <script src="physical-layer-transmit.js"></script>
        <script src="physical-layer.js"></script>
    </body>
</html>