<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Audio network - physical layer example</title>
        <link rel="stylesheet" type="text/css" href="physical-layer.css">
    </head>
    <body onLoad="onLoad()">

        <div class="main-container">

            <h1 onClick="destroy()">Audio network - physical layer example</h1>

            <h2>Settings/info</h2>
            <div class="container">
                <div class="row">
                    <div class="col-6">
                        <b>
                            Channel config [rx/rx ofdmSize]
                        </b>
                    </div>
                    <div class="col-6">
                        <input
                            type="text"
                            id="tx-channel"
                            value="1"
                            />
                        <input
                            type="text"
                            id="rx-channel"
                            value="1"
                            />
                        <a href="javascript:void(0)" onClick="reinitialize()">Reinitialize</a>
                    </div>
                </div>

                <div>
                    <b>Sample rate [Hz]</b>
                    <span id="sample-rate"></span>
                </div>
                <div>
                    <b>Tx buffer size</b>
                    <span id="tx-buffer-size"></span>
                </div>
                <div>
                    <b>Rx buffer size</b>
                    <span id="rx-buffer-size"></span>
                </div>
                <div>
                    <label for="symbol-duration">
                        Symbol duration [ms]
                    </label>
                    <input type="text" id="symbol-duration" value="400" />
                </div>
                <div>
                    <label for="guard-interval">
                        Guard interval [ms]
                    </label>
                    <input type="text" id="guard-interval" value="200" />
                </div>
                <div>
                    <b>
                        Output [tx]
                    </b>
                    <span>
                        <a href="javascript:void(0)" onClick="output('tx', true)">Enable</a>
                        <a href="javascript:void(0)" onClick="output('tx', false)">Disable</a>
                    </span>
                </div>
                <div>
                    <b>
                        Output [microphone]
                    </b>
                    <span>
                        <a href="javascript:void(0)" onClick="output('mic', true)">Enable</a>
                        <a href="javascript:void(0)" onClick="output('mic', false)">Disable</a>
                    </span>
                </div>
                <div>
                    <b>
                        Output [recorded audio]
                    </b>
                    <span>
                        <a href="javascript:void(0)" onClick="output('rec', true)">Enable</a>
                        <a href="javascript:void(0)" onClick="output('rec', false)">Disable</a>
                    </span>
                </div>
                <div>
                    <b>Rx input</b>
                    <span>
                        <a href="javascript:void(0)" onClick="rxInput('mic')">Microphone</a>
                        <a href="javascript:void(0)" onClick="rxInput('rxLoop')">RxLoopback</a>
                        <a href="javascript:void(0)" onClick="rxInput('rec')">Recorded file</a>
                    </span>
                </div>
                <div>
                    <b>Recorded audio url</b>
                    <span>
                        <br/>
                        http://codebuild.pl/an.wav
                        <br/>
                        <input type="text" id="recorded-audio-url" value="http://localhost:63342/ucEmu/an.wav" />
                        <br/>
                        <a href="javascript:void(0)" onClick="loadRecordedAudio()">Load</a>
                    </span>
                </div>
            </div>

            <h2>Receive</h2>
            <div class="container">

                <div class="row">
                    <div class="col-12">
                        <h3>Input spectrum</h3>
                    </div>                    
                </div>
                <div class="row">
                    <div class="col-12">
                        <div id="rx-spectrum"></div>
                    </div>
                </div>

                <div class="row" id="rx-channel-container">
                </div>

            </div>

            <h2>Transmit</h2>
            <div class="container">

                <div class="row" id="tx-channel-container">
                </div>

            </div>

        </div>

        <!-- audio network BEGIN -->
        <script src="../../src/common/math-util/math-util.service.js"></script>
        <script src="../../src/common/audio-util/audio-util.service.js"></script>
        <script src="../../src/common/queue/queue.factory.js"></script>
        <script src="../../src/common/queue/queue-builder.service.js"></script>
        <script src="../../src/physial-layer/analyser-chart/analyser-chart.factory.js"></script>
        <script src="../../src/physial-layer/audio/audio.service.js"></script>
        <script src="../../src/physial-layer/constellation-diagram/constellation-diagram.factory.js"></script>
        <script src="../../src/physial-layer/carrier-generate/carrier-generate.factory.js"></script>
        <script src="../../src/physial-layer/channel-receive/channel-receive.factory.js"></script>
        <script src="../../src/physial-layer/carrier-recovery/carrier-recovery.factory.js"></script>
        <script src="../../src/physial-layer/channel-transmit/channel-transmit.factory.js"></script>
        <script src="../../src/physial-layer/channel-transmit-manager/channel-transmit-manager.factory.js"></script>
        <script src="../../src/physial-layer/channel-receive-manager/channel-receive-manager.factory.js"></script>
        <script src="../../src/physial-layer/constellation-diagram/constellation-diagram-builder.service.js"></script>
        <script src="../../src/physial-layer/channel-transmit-manager/channel-transmit-manager-builder.service.js"></script>
        <script src="../../src/physial-layer/channel-receive-manager/channel-receive-manager-builder.service.js"></script>
        <script src="../../src/physial-layer/carrier-recovery/carrier-recovery-builder.service.js"></script>
        <script src="../../src/physial-layer/channel-transmit/channel-transmit-builder.service.js"></script>
        <script src="../../src/physial-layer/channel-receive/channel-receive-builder.service.js"></script>
        <script src="../../src/physial-layer/carrier-generate/carrier-generate-builder.service.js"></script>
        <script src="../../src/physial-layer/analyser-chart/analyser-chart-builder.service.js"></script>
        <script src="../../src/physial-layer/audio-network-physical-layer.factory.js"></script>
        <script src="../../src/physial-layer/audio-network-physical-layer-configuration.service.js"></script>
        <!-- audio network END -->

        <script id="template-tx-channel" type="text/html">
            <!-- channel begin -->
            <div class="col tx-channel">
                <div class="row">
                    <div class="col-12">
                        <h3>Channel #[[ channelIndex ]]</h3>
                    </div>
                </div>
                <div class="row">
                    <div class="col-6">
                        <b>Send sequence</b>
                    </div>
                    <div class="col-6">
                        <input type="text" id="tx-sequence-data-[[ channelIndex ]]" value="0 1 2 3 3 2 1 0" />
                        <input type="number" id="tx-sequence-psk-size-[[ channelIndex ]]" value="4" />
                        <a href="javascript:void(0)" onClick="transmitSequence([[ channelIndex ]])">Send sequence</a>
                    </div>
                </div>
                <div class="row" id="tx-channel-[[ channelIndex ]]-ofdm-container">
                </div>
            </div>
            <!-- channel end -->
        </script>

        <script id="template-tx-channel-ofdm" type="text/html">
            <!-- ofdm begin -->
            <div class="col tx-channel-ofdm">
                <div class="row">
                    <div class="col-12">
                        <h4>Channel #[[ channelIndex ]], OFDM #[[ ofdmIndex ]]</h4>
                    </div>
                </div>

                <div class="row">
                    <div class="col-6">
                        <label for="tx-frequency-input-[[ channelIndex ]]-[[ ofdmIndex ]]">Frequency [Hz]</label>
                    </div>
                    <div class="col-6">
                        <span id="tx-frequency-label-[[ channelIndex ]]-[[ ofdmIndex ]]"></span>
                        <input type="number" id="tx-frequency-input-[[ channelIndex ]]-[[ ofdmIndex ]]" />
                        <a
                            href="javascript:void(0)"
                            onClick="frequencyUpdate('tx', [[ channelIndex ]], [[ ofdmIndex ]])"
                            >
                            Update
                        </a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-6">
                        <label for="tx-phase-correction-input-[[ channelIndex ]]-[[ ofdmIndex ]]">
                            Phase correction
                        </label>
                    </div>
                    <div class="col-6">
                        <span id="tx-phase-correction-label-[[ channelIndex ]]-[[ ofdmIndex ]]"></span>
                        <input type="number" id="tx-phase-correction-input-[[ channelIndex ]]-[[ ofdmIndex ]]" />
                        <a
                            href="javascript:void(0)"
                            onClick="phaseCorrectionUpdate('tx', [[ channelIndex ]], [[ ofdmIndex ]])"
                            >
                            Update
                        </a>
                    </div>
                </div>

                <div class="row">
                    <div class="col-6">
                        <b>Send</b>
                    </div>
                    <div class="col-6">
                        <a href="javascript:void(0)" onClick="transmit([[ channelIndex ]], [[ ofdmIndex ]], 0.00)">
                            [phase + 0.00]
                        </a> |
                        <a href="javascript:void(0)" onClick="transmit([[ channelIndex ]], [[ ofdmIndex ]], 0.25)">
                            [phase + 0.25]
                        </a> |
                        <a href="javascript:void(0)" onClick="transmit([[ channelIndex ]], [[ ofdmIndex ]], 0.50)">
                            [phase + 0.50]
                        </a> |
                        <a href="javascript:void(0)" onClick="transmit([[ channelIndex ]], [[ ofdmIndex ]], 0.75)">
                            [phase + 0.75]
                        </a> |
                    </div>
                </div>
            </div>
            <!-- ofdm end -->
        </script>

        <script id="template-rx-channel" type="text/html">
            <!-- channel begin -->
            <div class="col rx-channel">
                <div class="row">
                    <div class="col-12">
                        <h3>Channel #[[ channelIndex ]]</h3>
                    </div>
                </div>
                <div class="row" id="rx-channel-[[ channelIndex ]]-ofdm-container">
                </div>
            </div>
            <!-- channel end -->
        </script>

        <script id="template-rx-channel-ofdm" type="text/html">
            <!-- ofdm begin -->
            <div class="col rx-channel-ofdm">
                <div class="row">
                    <div class="col-12">
                        <h4>Channel #[[ channelIndex ]], OFDM #[[ ofdmIndex ]]</h4>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <div
                            class="rx-constellation-diagram"
                            id="rx-constellation-diagram-[[ channelIndex ]]-[[ ofdmIndex ]]"
                        ></div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-6">
                        <b>Phase [deg]</b>
                    </div>
                    <div class="col-6">
                        <span id="rx-phase-[[ channelIndex ]]-[[ ofdmIndex ]]"></span>
                    </div>
                </div>
                <div class="row">
                    <div class="col-6">
                        <b>Power [dB]</b>
                    </div>
                    <div class="col-6">
                        <span id="rx-power-[[ channelIndex ]]-[[ ofdmIndex ]]"></span>
                    </div>
                </div>
                <div class="row">
                    <div class="col-6">
                        <label for="rx-frequency-input-[[ channelIndex ]]-[[ ofdmIndex ]]">Frequency [Hz]</label>
                    </div>
                    <div class="col-6">
                        <span id="rx-frequency-label-[[ channelIndex ]]-[[ ofdmIndex ]]"></span>
                        <input type="number" id="rx-frequency-input-[[ channelIndex ]]-[[ ofdmIndex ]]" />
                        <a
                            href="javascript:void(0)"
                            onClick="frequencyUpdate('rx', [[ channelIndex ]], [[ ofdmIndex ]])"
                            >
                            Update
                        </a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-6">
                        <label for="rx-phase-correction-input-[[ channelIndex ]]-[[ ofdmIndex ]]">
                            Phase correction
                        </label>
                    </div>
                    <div class="col-6">
                        <span id="rx-phase-correction-label-[[ channelIndex ]]-[[ ofdmIndex ]]"></span>
                        <input type="number" id="rx-phase-correction-input-[[ channelIndex ]]-[[ ofdmIndex ]]" />
                        <a
                            href="javascript:void(0)"
                            onClick="phaseCorrectionUpdate('rx', [[ channelIndex ]], [[ ofdmIndex ]])"
                            >
                            Update
                        </a>
                    </div>
                </div>
            </div>
            <!-- ofdm end -->
        </script>

        <script src="physical-layer.js"></script>
    </body>
</html>